import{i as w,a as A,p as E,b as L}from"./fJtxBR6D.js";function g(t){const r=JSON.parse(t);return r.data&&(r.data=E(r.data,L.decoders)),r}function l(t){return HTMLElement.prototype.cloneNode.call(t)}function H(t,r=()=>{}){const p=async({action:a,result:c,reset:o=!0,invalidateAll:i=!0})=>{c.type==="success"&&(o&&HTMLFormElement.prototype.reset.call(t),i&&await w()),(location.origin+location.pathname===a.origin+a.pathname||c.type==="redirect"||c.type==="error")&&await A(c)};async function u(a){if((a.submitter?.hasAttribute("formmethod")?a.submitter.formMethod:l(t).method)!=="post")return;a.preventDefault();const o=new URL(a.submitter?.hasAttribute("formaction")?a.submitter.formAction:l(t).action),i=a.submitter?.hasAttribute("formenctype")?a.submitter.formEnctype:l(t).enctype,s=new FormData(t),m=a.submitter?.getAttribute("name");m&&s.append(m,a.submitter?.getAttribute("value")??"");const d=new AbortController;let f=!1;const y=await r({action:o,cancel:()=>f=!0,controller:d,formData:s,formElement:t,submitter:a.submitter})??p;if(f)return;let n;try{const e=new Headers({accept:"application/json","x-sveltekit-action":"true"});i!=="multipart/form-data"&&e.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(i)?i:"application/x-www-form-urlencoded");const h=i==="multipart/form-data"?s:new URLSearchParams(s),b=await fetch(o,{method:"POST",headers:e,cache:"no-store",body:h,signal:d.signal});n=g(await b.text()),n.type==="error"&&(n.status=b.status)}catch(e){if(e?.name==="AbortError")return;n={type:"error",error:e}}await y({action:o,formData:s,formElement:t,update:e=>p({action:o,result:n,reset:e?.reset,invalidateAll:e?.invalidateAll}),result:n})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",u),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",u)}}}export{H as e};
